--- 
title: "Food Security Analysis for Cadre Harmonise"
author: "WFP RBD VAM"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output: bookdown::gitbook
biblio-style: apalike
link-citations: yes
description: "This is a minimal example of using R for food security analysis"
---


blah blah some text

<!--chapter:end:index.Rmd-->

# Introduction

Here there be blah blah blah

<!--chapter:end:01-Introduction.Rmd-->

# reduced Coping Strategy Index (rCSI)

### Standardized Module

Variable Name | Question Label 
---- | ------------- 
rCSILessQlty | In the past 7 days, how many days has your household had to: *Rely on less preferred and less expensive food* because you did not have enough food or money to buy food?
rCSIBorrow | In the past 7 days, how many days has your household had to: *Borrow food or rely on help from a relative or friend* because you did not have enough food or money to buy food?
rCSIMealSize | In the past 7 days, how many days has your household had to: *Limit portion size of meals* because you did not have enough food or money to buy food?
rCSIMealAdult  | In the past 7 days, how many days has your household had to: *Restrict consumption by adults in order for small children to eat* because you did not have enough food or money to buy food?
rCSIMealNb | In the past 7 days, how many days has your household had to: *Reduce the number of meals eaten per day* because you did not have enough food or money to buy food?

### Standardized Module - data collection form

Here is the standardized module in xlsform: [RBDstandardized_questionnairerCSI](https://www.dropbox.com/s/gsj4tvadww9v3q4/RBDstandardized_questionnairerCSI.xlsx?dl=0) 


### Analysis 

#### Example data set
[exampledatsetrCSI]([exampledatsetHHS](https://www.dropbox.com/sh/g2s87u60cc0yx6v/AABdYDfCkJlyP1DlgRoEc0gDa?dl=0) 

#### SPSS Syntax

```{r, eval = F}

COMPUTE rCSI = rCSILessQlty  + (2 * rCSIBorrow) + rCSIMealSize + (3 * rCSIMealAdult) + rCSIMealNb.
EXECUTE .



```

Here is the SPSS syntax file: 
[RBDstandardized_spsssyntaxrCSI](https://www.dropbox.com/s/gsj4tvadww9v3q4/RBDstandardized_questionnairerCSI.xlsx?dl=0) 


#### R Syntax

```{r, eval = F}
library(haven)
library(labelled)
library(tidyverse)

#import dataset
datarCSIEng <- read_sav("datarCSIEng.sav")

#Calculate HHS 
datarCSIEng <- to_factor(datarCSIEng)

#calculate rCSI Score
datarCSIEng <- datarCSIEng %>% mutate(rCSI = rCSILessQlty  + (2 * rCSIBorrow) + rCSIMealSize + (3 * rCSIMealAdult) + rCSIMealNb)

#convert rCSI Score into thresholds 
datarCSIEng <- datarCSIEng %>% mutate(CH_rCSI = case_when(
  rCSI <= 3 ~ "Phase1", 
  between(rCSI,4,18) ~ "Phase2",       
  rCSI >= 19 ~ "Phase3"))

#Generate table of proportion of households in CH rCSI phases by Adm1 and Adm2 using weights
CH_rCSI_table_wide <- datarCSIEng %>% group_by(ADMIN1Name, ADMIN2Name) %>%
  drop_na(CH_rCSI) %>%
  count(CH_rCSI, wt = hh_weight) %>%
  mutate(perc = 100 * n / sum(n)) %>%
  ungroup() %>% select(-n) %>%
  spread(key = CH_rCSI, value = perc) %>% replace(., is.na(.), 0)  %>% mutate_if(is.numeric, round, 1)
```


Here is the R syntax file: 
[RBDstandardized_RsyntaxrCSI](https://www.dropbox.com/s/gsj4tvadww9v3q4/RBDstandardized_questionnairerCSI.xlsx?dl=0) 


<!--chapter:end:02-reduced-Coping-Strategy-Index.Rmd-->

# Household Hunger Score

### Standardized Module

Variable Name | Question Label | Answer Choices
---- | ------------- |---- 
HHhSNoFood_YN | In the past [4 weeks/30 days], was there ever no food to eat of any kind in your house because of lack of resources to get food? | 1) Yes 0) No
HHhSNoFood_FR | How often did this happen in the past [4 weeks/30 days]? | 1) Rarely (1–2 times) 2) Sometimes (3–10 times)  3) Often (more than 10 times)
HHhSBedHung_YN | In the past [4 weeks/30 days], did you or any household member go to sleep at night hungry because there was not enough food? | 1) Yes 0) No
HHhSBedHung_FR  | How often did this happen in the past [4 weeks/30 days]? | 1) Rarely (1–2 times) 2) Sometimes (3–10 times)  3) Often (more than 10 times)
HHhSNotEat_YN | In the past [4 weeks/30 days], did you or any household member go to sleep at night hungry because there was not enough food? | 1) Yes 0) No
HHhSNotEat_FR | How often did this happen in the past [4 weeks/30 days]? | 1) Rarely (1–2 times) 2) Sometimes (3–10 times)  3) Often (more than 10 times)

### Standardized Module - data collection form

Here is the standardized module in xlsform: [RBDstandardized_questionnairerHHS](https://www.dropbox.com/s/a7e4ty3rvw19e89/RBDstandardized_questionnaireHHS.xlsx?dl=0) 

### Analysis 

#### Example data set
[exampledatsetHHS](https://www.dropbox.com/sh/g2s87u60cc0yx6v/AABdYDfCkJlyP1DlgRoEc0gDa?dl=0) 

Here is the example data set:

#### SPSS Syntax

```{r, eval = F}

COMPUTE rCSI = rCSILessQlty  + (2 * rCSIBorrow) + rCSIMealSize + (3 * rCSIMealAdult) + rCSIMealNb.
EXECUTE .



```

Here is the SPSS syntax file: 
[RBDstandardized_spsssyntaxrCSI](https://www.dropbox.com/s/gsj4tvadww9v3q4/RBDstandardized_questionnairerCSI.xlsx?dl=0) 


#### R Syntax

```{r, eval = F}
library(haven)
library(labelled)
library(tidyverse)

#import dataset
dataHHSEng <- read_sav("dataHHSEng.sav")

#Calculate HHS 
dataHHSEng <- to_factor(dataHHSEng)

#Recode HHS questions into new variables with score 
dataHHSEng <- dataHHSEng %>% mutate(HHhSNoFood_FR_r = case_when(
                                      HHhSNoFood_FR == "Rarely (1–2 times)" ~ 1,
                                      HHhSNoFood_FR == "Sometimes (3–10 times)" ~ 1,
                                      HHhSNoFood_FR == "Often (more than 10 times)" ~ 2,
                                      TRUE ~ 0),
                                    HHhSBedHung_FR_r = case_when(
                                      HHhSBedHung_FR == "Rarely (1–2 times)" ~ 1,
                                      HHhSBedHung_FR == "Sometimes (3–10 times)" ~ 1,
                                      HHhSBedHung_FR == "Often (more than 10 times)" ~ 2,
                                      TRUE ~ 0),
                                    HHhSNotEat_FR_r = case_when(
                                      HHhSNotEat_FR == "Rarely (1–2 times)" ~ 1,
                                      HHhSNotEat_FR == "Sometimes (3–10 times)" ~ 1,
                                      HHhSNotEat_FR == "Often (more than 10 times)" ~ 2,
                                      TRUE ~ 0))
#Calculate HHS
dataHHSEng <- dataHHSEng %>% mutate(HHhS = HHhSNoFood_FR_r + HHhSBedHung_FR_r + HHhSNotEat_FR_r)

#Convert HH Scores to CH phases
dataHHSEng <- dataHHSEng %>% mutate(CH_HHS = case_when(
    HHhS == 0 ~ "Phase1",
    HHhS == 1 ~ "Phase2",
    HHhS %in% c(2,3,4) ~ "Phase3",
    HHhS == 4 ~ "Phase4",  
    HHhS >= 5 ~ "Phase5"))

#Generate table of proportion of households in CH HHS phases by Adm1 and Adm2 using weights
CH_HHS_table_wide <- dataHHSEng %>% group_by(ADMIN1Name, ADMIN2Name) %>%
  drop_na(CH_HHS) %>%
  count(CH_HHS, wt = hh_weight) %>%
  mutate(perc = 100 * n / sum(n)) %>%
  ungroup() %>% select(-n) %>%
  spread(key = CH_HHS, value = perc) %>% replace(., is.na(.), 0)  %>% mutate_if(is.numeric, round, 1)
```


Here is the R syntax file: 
[RBDstandardized_RsyntaxHHS](https://www.dropbox.com/s/xnzi9vfsapakhvo/RBDstandardized_RsyntaxHHS.R?dl=0) 

<!--chapter:end:03-Household-Hunger-Scale.Rmd-->

# Food Consumption Score

Variable Name | Question Label 
---- | ------------- 
FCSStapCer | Over the last 7 days, how many days did members of your household eat Cereals, such as: (cereals, grains, rice, pasta, bread, sorghum, millet, maize, fonio)   
HDDSStapCer | Yesterday, during the day and night, did members in your household eat Cereals, such as: (cereals, grains,rice, pasta, bread, sorghum, millet, maize, fonio) 
FCSStapCerSRf | Over the last 7 days, what was the main source of Cereals, such as:  (cereals, grains, rice, pasta, bread, sorghum, millet, maize, fonio) 
FCSStapRoot | Over the last 7 days, how many days did members of your household eat Roots and Tubers, such as: (potato, yam, cassava, white sweet potato) 
HDDSStapRoot | Yesterday, during the day and night, did members in your household eat Roots and Tubers, such as: (potato, yam, cassava, white sweet potato)
FCSStapRootSRf | Over the last 7 days, what was the main source of Roots and Tubers, such as: (potato, yam, cassava, white sweet potato) 
FCSPulse | How many days over the last 7 days, did members of your household eat Pulses, such as: (beans, cowpeas, peanuts, lentils, nut, soy, pigeon pea and / or other nuts) 
HDDSPulse | Yesterday, during the day and night, did members in your household eat Pulses, such as: (beans, cowpeas, peanuts, lentils, nut, soy, pigeon pea and / or other nuts) 
FCSPulseSRf | Over the last 7 days, What was the main source of Pulses, such as: (beans, cowpeas, peanuts, lentils, nut, soy, pigeon pea and / or other nuts) 
FCSDairy | Over the last 7 days, how many days did members of your household eat/drink Milk and dairy products, such as:(fresh milk / sour, yogurt, cheese, other dairy products) excluding margarine / butter or small amounts of milk for tea / coffee ?
HDDSDairy | Yesterday, during the day and night, did members in your household eat/drink Milk and dairy products, such as: (fresh milk / sour, yogurt, cheese, other dairy products) excluding margarine / butter or small amounts of milk for tea / coffee ?
FCSDairySRf | Over the last 7 days, what was the main source of Milk and dairy products, such as: (fresh milk / sour, yogurt, cheese, other dairy products)  replace with locally relevant examples excluding margarine / butter or small amounts of milk for tea / coffee ?
FCSPr | Over the last 7 days, how many days did members of your household eat: Meat, fish, eggs, such as: (goat, beef, chicken, pork, blood, fish, including canned tuna, escargot, and / or other seafood, eggs) consumed in large quantities and not as a condiment ?
FCSPrMeatF | Over the last 7 days, how many days did members of your household eat: Flesh/red meat, such as: (beef, pork, lamb, goat, rabbit, chicken, duck, other birds, insects) consumed in large quantities and not as a condiment ?
HDDSPrMeatF | Yesterday, during the day and night, did members in your household eat: Flesh/red meat , such as: (beef, pork, lamb, goat, rabbit, chicken, duck, other birds, insects) consumed in large quantities and not as a condiment ?
FCSPrMeatFSRf | Over the last 7 days,What was the main source of Flesh/red meat , such as: (beef, pork, lamb, goat, rabbit, chicken, duck, other birds, insects) consumed in large quantities and not as a condiment ?
FCSPrMeatO | Over the last 7 days, how many days did members of your household eat: Organ meat, such as: (liver, kidney, heart and / or other organ meats) consumed in large quantities and not as a condiment ?
HDDSPrMeatO | Yesterday, during the day and night, did members in your household eat: Organ meat, such as: (liver, kidney, heart and / or other organ meats) consumed in large quantities and not as a condiment ?
FCSPrMeatOSRf | Over the last 7 days,What was the main source of Organ meat, such as: (liver, kidney, heart and / or other organ meats) consumed in large quantities and not as a condiment ?
FCSPrFish | Over the last 7 days, how many days did members of your household eat: Fish, such as: (fish, including canned tuna, escargot, and / or other seafood) consumed in large quantities and not as a condiment ?
HDDSPrFish | Yesterday, during the day and night, did members in your household eat: Fish, such as: (fish, including canned tuna, escargot, and / or other seafood) consumed in large quantities and not as a condiment ?
FCSPrFishSRf | Over the last 7 days,What was the main source of Fish, such as: (fish, including canned tuna, escargot, and / or other seafood) consumed in large quantities and not as a condiment ?
FCSPrEgg | How many days over the last 7 days, did members of your household eat : Eggs consumed in large quantities and not as a condiment ?
HDDSPrEgg | Yesterday, during the day and night, did members in your household eat: Eggs consumed in large quantities and not as a condiment ?
FCSPrEggSRf | Over the last 7 days,What was the main source of Eggs consumed in large quantities and not as a condiment ?
FCSVeg | Over the last 7 days, how many days did members of your household eat: Vegetables such as (spinach, onion, tomatoes, carrots, peppers, green beans, lettuce, etc.) ?
FCSVegOrg | Over the last 7 days, how many days did members of your household eat: Orange vegetables , such as: (carrot, red pepper, pumpkin, orange sweet potatoes, etc.) ?
HDDSVegOrg | Yesterday, during the day and night, did members in your household eat: Orange vegetables , such as: (carrot, red pepper, pumpkin, orange sweet potatoes, etc.) ?
FCSVegOrgSRf | Over the last 7 days,What was the main source of: Orange vegetables , such as: (carrot, red pepper, pumpkin, orange sweet potatoes, etc.) ?
FCSVegGre | Over the last 7 days, how many days did members of your household eat: Green leafy vegetables, such as: (spinach, broccoli, amaranth and / or other dark green leaves, cassava leaves, etc.) ?
HDDSVegGre | esterday, during the day and night, did members in your household eat: Green leafy vegetables, such as: (spinach, broccoli, amaranth and / or other dark green leaves, cassava leaves, etc.) ?
FCSVegGreSRf | Over the last 7 days,What was the main source of: Green leafy vegetables, such as: (spinach, broccoli, amaranth and / or other dark green leaves, cassava leaves, etc.) ?
FCSVegOth | Over the last 7 days, how many days did members of your household eat: Other Vegetables, such as: (Onion, tomatos, cucumber, radish, green beans, peas, etc) ?
HDDSVegOth | Yesterday, during the day and night, did members in your household eat: Other Vegetables, such as: (Onion, tomatos, cucumber, radish, green beans, peas, etc) ?
FCSVegOthSRf | Over the last 7 days,What was the main source of: Other Vegetables, such as: (Onion, tomatos, cucumber, radish, green beans, peas, etc) ?
FCSFruit | Over the last 7 days, how many days did members of your household eat: Fruits, such as:(banana, apple, lemon, mango, papaya, apricot, peach, etc.) ?
FCSFruitOrg | Over the last 7 days, how many days did members of your household eat: Orange fruits, such as: (mango, papaya, apricot, peach, etc.)
HDDSFruitOrg | Yesterday, during the day and night, did members in your household eat: Orange fruits, such as: (mango, papaya, apricot, peach, etc.)?
FCSFruitOrgSRf | Over the last 7 days,What was the main source of: Orange fruits, such as: (mango, papaya, apricot, peach, etc.) ?
FCSFruitOth | Over the last 7 days, how many days did members of your household eat: Other fruits, such as: (Pinapple, apple, lemon, etc.)?
HDDSFruitOth | Yesterday, during the day and night, did members in your household eat: Orange fruits, such as: (mango, papaya, apricot, peach, etc.)?
FCSFruitOthSRF | Over the last 7 days, how many days did members of your household eat: Other fruits, such as: (Pinapple, apple, lemon, etc.)?
FCSFat | Over the last 7 days,What was the main source of:  Fats and oils,such as: (vegetable oil, palm oil, shea butter, margarine, other fats /oil)?
HDDSFat | Yesterday, during the day and night, did members in your household eat: Fats and oils,such as: (vegetable oil, palm oil, shea butter, margarine, other fats /oil)?
FCSFatSRf | Over the last 7 days,What was the main source of:  Fats and oils,such as: (vegetable oil, palm oil, shea butter, margarine, other fats /oil)?
FCSSugar | Over the last 7 days,What was the main source of:  Sugar and sweets, such as: (sugar, honey, jam, cakes, candy, cookies, pastries, cakes and other sweet sugary drinks)?
HDDSSugar | Yesterday, during the day and night, did members in your household eat: Sugar and sweets, such as:(sugar, honey, jam, cakes, candy, cookies, pastries, cakes and other sweet sugary drinks)?
FCSSugarSRf | Over the last 7 days,What was the main source of: Sugar and sweets, such as: (sugar, honey, jam, cakes, candy, cookies, pastries, cakes and other sweet sugary drinks)?
FCSCond | Over the last 7 days, What was the main source of: Condiments/Spices: such as: (tea, coffee / cocoa, salt, garlic, spices, yeast / baking powder, tomato / sauce, meat or fish as a condiment, condiments including small amount of milk / tea coffee)?
HDDSCond | Yesterday, during the day and night, did members in your household eat: Condiments/Spices: such as: (tea, coffee / cocoa, salt, garlic, spices, yeast / baking powder, tomato / sauce, meat or fish as a condiment, condiments including small amount of milk / tea coffee)?
FCSCondSRf | Over the last 7 days,What was the main source of: Condiments/Spices: such as: (tea, coffee / cocoa, salt, garlic, spices, yeast / baking powder, tomato / sauce, meat or fish as a condiment, condiments including small amount of milk / tea coffee)?
 

<!--chapter:end:04-Food-Consumption-Score.Rmd-->

# Household Dietary Diversity Score

Some _significant_ applications are demonstrated in this chapter.

## Example one

## Example two

<!--chapter:end:05-Household-Dietary-Diversity-Score.Rmd-->

# Livelihood Coping Strategies

## Standardized Module - Light (Preferred Version)

Variable Name | Question Label | Answer Choices
---- | ------------- |------- 
LhCSIStress1_lt | During the past 30 days, did anyone in your household have to: *Sell household assets/goods  radio, furniture, refrigerator, television, jewelry etc..)* due to a lack of food or a lack of money to buy food? | 1) No, because I did not face a shortage of food 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Yes 4) Not applicable
LhCSIStress2_lt | During the past 30 days, did anyone in your household have to: *sell more animals (non-productive) than usual* due to a lack of food or a lack of money to buy food? | 1) No, because I did not face a shortage of food 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Yes 4) Not applicable
LhCSIStress3_lt | During the past 30 days, did anyone in your household have to: *spend savings* due to a lack of food or a lack of money to buy food? | 1) No, because I did not face a shortage of food 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Yes 4) Not applicable
LhCSIStress4_lt | During the past 30 days, did anyone in your household have to: *Borrow money / food  from a formal lender / bank* due to a lack of food or a lack of money to buy food? | 1) No, because I did not face a shortage of food 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Yes 4) Not applicable
LhCSICrisis1_lt | During the past 30 days, did anyone in your household have to: *Reduce non-food expenses on health (including drugs) and education * due to a lack of food or a lack of money to buy food? | 1) No, because I did not face a shortage of food 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Yes 4) Not applicable
LhCSICrisis2_lt | During the past 30 days, did anyone in your household have to: *sell productive assets or means of transport (sewing machine, wheelbarrow, bicycle, car, etc..)* due to a lack of food or a lack of money to buy food? | 1) No, because I did not face a shortage of food 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Yes 4) Not applicable
LhCSICrisis3_lt | During the past 30 days, did anyone in your household have to: *withdraw children from school* due to a lack of food or a lack of money to buy food? | 1) No, because I did not face a shortage of food 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Yes 4) Not applicable
LhCSIEmergency1_lt | During the past 30 days, did anyone in your household have to: *sell house or land* due to a lack of food or a lack of money to buy food? | 1) No, because I did not face a shortage of food 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Yes 4) Not applicable
LhCSIEmergency2_lt | During the past 30 days, did anyone in your household have to: *sell last female animals* due to a lack of food or a lack of money to buy food? | 1) No, because I did not face a shortage of food 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Yes 4) Not applicable
LhCSIEmergency3_lt | During the past 30 days, did anyone in your household have to: *beg * due to a lack of food or a lack of money to buy food? | 1) No, because I did not face a shortage of food 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Yes 4) Not applicable

### Standardized Module (light module- data collection form

Here is the standardized module in xlsform: [RBDstandardized_questionnaireLHCSI](https://www.dropbox.com/s/wfiuy5kn8yhd0ct/RBDstandardized_questionnaireLHCSI.xlsx?dl=0) 

### Analysis 

#### Example data set
[dataLHCSLightEng](https://www.dropbox.com/s/44f5or8njr1nlr8/dataLHCSLightEng.sav?dl=0) 

Here is the example data set:

#### SPSS Syntax

```{r, eval = F}
```

Here is the SPSS syntax file: 
[RBDstandardized_spsssyntaxrCSI](https://www.dropbox.com/s/gsj4tvadww9v3q4/RBDstandardized_questionnairerCSI.xlsx?dl=0) 


#### R Syntax

```{r, eval = F}
library(haven)
library(labelled)
library(tidyverse)

#import dataset
dataLHCSLightEng <- read_sav("dataLHCSLightEng.sav")

#Calculate HHS 
dataLHCSLightEng <- to_factor(dataLHCSLightEng)

#create a variable to specify if the household used any of the strategies by severity 
#stress
dataLHCSLightEng <- dataLHCSLightEng %>% mutate(stress_coping = case_when(
LhCSIStress1_lt %in% c("Yes","No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it") ~ "usedstress",
LhCSIStress2_lt %in% c("Yes","No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it") ~ "usedstress",
LhCSIStress3_lt %in% c("Yes","No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it") ~ "usedstress",
LhCSIStress4_lt %in% c("Yes","No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it") ~ "usedstress",
TRUE ~ "notusedstress"))
#Crisis
dataLHCSLightEng <- dataLHCSLightEng %>% mutate(crisis_coping = case_when(
LhCSICrisis1_lt %in% c("Yes","No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it") ~ "usedcrisis",
LhCSICrisis2_lt %in% c("Yes","No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it") ~ "usedcrisis",
LhCSICrisis3_lt %in% c("Yes","No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it") ~ "usedcrisis",
TRUE ~ "notusedcrisis"))
#Emergency
dataLHCSLightEng <- dataLHCSLightEng %>% mutate(emergency_coping = case_when(
LhCSIEmergency1_lt %in% c("Yes","No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it") ~ "usedemergency",
LhCSIEmergency2_lt %in% c("Yes","No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it") ~ "usedemergency",
LhCSIEmergency3_lt %in% c("Yes","No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it") ~ "usedemergency",
TRUE ~ "noutusedemergency"))

#calculate Max_coping_behaviour
dataLHCSLightEng <- dataLHCSLightEng %>% mutate(LhCSICat = case_when(
  emergency_coping == "usedemergency" ~ "EmergencyStrategies",
  crisis_coping == "usedcrisis" ~ "CrisisStrategies",
  stress_coping == "usedstress" ~ "StressStrategies",
  TRUE ~ "NoStrategies"))

#Generate table of proportion of households in CH LhCHS phases by Adm1 and Adm2 using weights
#Livelihood Coping Strategies 
LhHCSCat_table_wide <- dataLHCSLightEng %>% 
  drop_na(LhCSICat) %>%
  group_by(ADMIN1Name, ADMIN2Name) %>%
  count(LhCSICat, wt = WeightHH) %>%
  mutate(perc = 100 * n / sum(n)) %>%
  ungroup() %>% select(-n) %>%
  spread(key = LhCSICat, value = perc) %>% replace(., is.na(.), 0) %>% mutate_if(is.numeric, round, 1)
```


Here is the R syntax file: 
[Dstandardized_RsyntaxLHCSIlight](https://www.dropbox.com/s/w9ji722dlk6bugv/RBDstandardized_RsyntaxLHCSIlight.R?dl=0) 


## Standard Version

Variable Name | Question Label | Answer Choices
---- | ------------- |------- 
LhCSIStress1_YN | During the past 30 days, did anyone in your household have to: *Sell household assets/goods  radio, furniture, refrigerator, television, jewelry etc..)* due to a lack of food or a lack of money to buy food? | 0) No 1) Yes
LhCSIStress1_N | If ‘No’, please clarify: | 1) No, because it wasn’t necessary 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Not applicable
LhCSIStress2_YN | During the past 30 days, did anyone in your household have to: *sell more animals (non-productive) than usual* due to a lack of food or a lack of money to buy food? | 0) No 1) Yes
LhCSIStress2_N | If ‘No’, please clarify: | 1) No, because it wasn’t necessary 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Not applicable
LhCSIStress3_YN | During the past 30 days, did anyone in your household have to: *spend savings* due to a lack of food or a lack of money to buy food? | 0) No 1) Yes
LhCSIStress3_N | If ‘No’, please clarify: | 1) No, because it wasn’t necessary 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Not applicable
LhCSIStress4_YN | During the past 30 days, did anyone in your household have to: *Borrow money / food  from a formal lender / bank* due to a lack of food or a lack of money to buy food? | 0) No 1) Yes
LhCSIStress4_N | If ‘No’, please clarify: | 1) No, because it wasn’t necessary 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Not applicable
LhCSICrisis1_YN | During the past 30 days, did anyone in your household have to: *Reduce non-food expenses on health (including drugs) and education * due to a lack of food or a lack of money to buy food? | 0) No 1) Yes
LhCSICrisis1_N | If ‘No’, please clarify: | 1) No, because it wasn’t necessary 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Not applicable
LhCSICrisis2_YN | During the past 30 days, did anyone in your household have to: *sell productive assets or means of transport (sewing machine, wheelbarrow, bicycle, car, etc..)* due to a lack of food or a lack of money to buy food? | 0) No 1) Yes
LhCSICrisis2_N | If ‘No’, please clarify: | 1) No, because it wasn’t necessary 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Not applicable
LhCSICrisis3_YN | During the past 30 days, did anyone in your household have to: *withdraw children from school* due to a lack of food or a lack of money to buy food? | 0) No 1) Yes
LhCSICrisis3_N | If ‘No’, please clarify: | 1) No, because it wasn’t necessary 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Not applicable
LhCSIEmergency1_YN | During the past 30 days, did anyone in your household have to: *sell house or land* due to a lack of food or a lack of money to buy food? | 0) No 1) Yes
LhCSIEmergency1_N | If ‘No’, please clarify: | 1) No, because it wasn’t necessary 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Not applicable
LhCSIEmergency2_YN | During the past 30 days, did anyone in your household have to: *sell last female animals* due to a lack of food or a lack of money to buy food? | 0) No 1) Yes
LhCSIEmergency2_N | If ‘No’, please clarify: | 1) No, because it wasn’t necessary 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Not applicable
LhCSIEmergency3_YN | During the past 30 days, did anyone in your household have to: *beg * due to a lack of food or a lack of money to buy food? | 0) No 1) Yes
LhCSIEmergency3_N | If ‘No’, please clarify: | 1) No, because it wasn’t necessary 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Not applicable

### Standardized Module (light module- data collection form

Here is the standardized module in xlsform: [RBDstandardized_questionnaireLHCSI](https://www.dropbox.com/s/wfiuy5kn8yhd0ct/RBDstandardized_questionnaireLHCSI.xlsx?dl=0) 

### Analysis 

#### Example data set
[dataLHCSstandardEng](https://www.dropbox.com/s/3ua1zja0ln4ojsl/dataLHCSstandardEng.sav?dl=0) 

Here is the example data set:

#### SPSS Syntax

```{r, eval = F}
```

Here is the SPSS syntax file: 
[RBDstandardized_spsssyntaxrCSI](https://www.dropbox.com/s/gsj4tvadww9v3q4/RBDstandardized_questionnairerCSI.xlsx?dl=0) 


#### R Syntax

```{r, eval = F}
library(haven)
library(labelled)
library(tidyverse)

#import dataset
dataLHCSstandardEng<- read_sav("dataLHCSstandardEng.sav")

#Calculate HHS 
dataLHCSstandardEng <- to_factor(dataLHCSstandardEng)

#create a variable to specify if the household used any of the strategies by severity 
#stress
dataLHCSstandardEng <- dataLHCSstandardEng %>% mutate(stress_coping = case_when(
LhCSIStress1_YN == "Yes" | LhCSIStress1_N == "No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it" ~ "usedstress",
LhCSIStress2_YN == "Yes" | LhCSIStress2_N == "No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it" ~ "usedstress", 
LhCSIStress3_YN == "Yes" | LhCSIStress3_N == "No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it" ~ "usedstress",
LhCSIStress4_YN == "Yes" | LhCSIStress4_N == "No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it" ~ "usedstress",
TRUE ~ "notusedstress"))
#Crisis
dataLHCSstandardEng <- dataLHCSstandardEng %>% mutate(crisis_coping = case_when(
LhCSICrisis1_YN == "Yes" | LhCSICrisis1_N == "No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it" ~ "usedcrisis",
LhCSICrisis2_YN == "Yes" | LhCSICrisis2_N == "No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it" ~ "usedcrisis",
LhCSICrisis3_YN == "Yes" | LhCSICrisis3_N == "No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it" ~ "usedcrisis",
TRUE ~ "notusedcrisis"))
#Emergency
dataLHCSstandardEng <- dataLHCSstandardEng %>% mutate(emergency_coping = case_when(
LhCSIEmergency1_YN == "Yes" | LhCSIEmergency1_N == "No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it" ~ "usedemergency",
LhCSIEmergency2_YN == "Yes" | LhCSIEmergency2_N == "No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it" ~ "usedemergency",
LhCSIEmergency3_YN == "Yes" | LhCSIEmergency3_N == "No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it" ~ "usedemergency",
TRUE ~ "notusedemergency"))

#calculate Max_coping_behaviour
dataLHCSLightEng <- dataLHCSLightEng %>% mutate(LhCSICat = case_when(
  emergency_coping == "usedemergency" ~ "EmergencyStrategies",
  crisis_coping == "usedcrisis" ~ "CrisisStrategies",
  stress_coping == "usedstress" ~ "StressStrategies",
  TRUE ~ "NoStrategies"))

#Generate table of proportion of households in CH LhCHS phases by Adm1 and Adm2 using weights
#Livelihood Coping Strategies 
LhHCSCat_table_wide <- dataLHCSLightEng %>% 
  drop_na(LhCSICat) %>%
  group_by(ADMIN1Name, ADMIN2Name) %>%
  count(LhCSICat, wt = WeightHH) %>%
  mutate(perc = 100 * n / sum(n)) %>%
  ungroup() %>% select(-n) %>%
  spread(key = LhCSICat, value = perc) %>% replace(., is.na(.), 0) %>% mutate_if(is.numeric, round, 1)
```


Here is the R syntax file: 
[RBDstandardized_RsyntaxLHCSIStandard](https://www.dropbox.com/s/2522nrx8wpf1vss/RBDstandardized_RsyntaxLHCSIStandard.R?dl=0) 


## Essential Needs Assesment Standardized Module 

Variable Name | Question Label | Answer Choices
---- | ------------- |------- 
LhCSIDomAsset_EN | During the past 30 days, did anyone in your household have to: *Sell household assets/goods (radio, furniture, refrigerator, television, jewelry etc..)*  because there was not enough resources (food, cash, else) to meet essential needs (e.g. adequate shelter, education services, health services, food, etc)? | 1) No, because I did not face a shortage of food 2) No; because I already sold those assets or did this activity in the last 12 months and cannot continue to do it 3) Yes 4) Not applicable


<!--chapter:end:06-Livelihood-Coping-Strategies.Rmd-->

# Gecodes

Using names as identifiers can easily lead to confusion over spelling and transliterations as well as alternative and duplicate names.

As unique identifiers, P-Codes overcome the challenges of linking datasets and confirming locations.

We recommend using Gecodes and Names from OCHA's Common Operational Datasets: 
https://data.humdata.org/dashboards/cod?ext_geodata=1&q=&ext_page_size=25

## A brief example of the problem:

The geographic variables of the *choices* section of the  xlsform typically look like this

list_name | name | label
---- | --- |---- 
cod_lga | 1 | ASKIRA/UBA
cod_lga | 2 | BAYO
cod_lga | 3 | CHIBOK
cod_lga | 4 | KALABAGE

The geographic variables in corresponding GIS dataset look like this:

Shape | admin2Pcode | admin2RefName
---- | --- |---- 
Polygon |NG008002 | Askira/Uba
Polygon |NG008004 | Bayo
Polygon |NG008006 | Chibok
Polygon |NG008015 | Kala/Balge

Unfortunately, if we tried to merge the dataset and the GIS file by the name of the area, we would first have to fix the capitalization and punctuation of the names.

To avoid unnecessary work, we recommend putting in the *Pcode* in the name column of the xlsform:

list_name | name | label
---- | --- |---- 
cod_lga | NG008002 | ASKIRA/UBA
cod_lga | NG008004 | BAYO
cod_lga | NG008006 | CHIBOK
cod_lga | NG008015 | KALABAGE

With a common, simple variable to merge both datasets, mapping and data processing will be much easier!

## Where to find Pcodes

Geographic data can be found https://data.humdata.org/dashboards/cod?ext_geodata=1&q=&ext_page_size=25 and searching for the appropriate country.

We recommend using the codes from the *admin1Pcode* and *admin2Pcode* columns in the *name* column of the xlsform.  Using the *admin1RefName* and *admin2RefName*

## Example data set of the data collection sheet for Nigeria:
[xlsformwithgeocodesexample](https://www.dropbox.com/s/qt2s1rbcf1zecn2/xlsformwithgeocodesexample.xlsx?dl=0) 



## 2 caveats

1. In some countries, the boundaries in the CODS might not correspond with the latest boundaries used by the country.  In this case, special development of a GIS boundary file and codes will need to be developed.

2. Inserting the relevant pcodes in the *name* column will probably require some *vlookup* .  This might be relatively straightforward when only replacing codes at the admin1 and admin2 level, however things might get more complicated and difficult if cascading columns and the *choice_filter* option is used at the adm3, adm4 level. 




<!--chapter:end:07-Geocodes.Rmd-->

